


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.5">
    
    
      
        <title>Advanced Usage - jax-unirep: A performant reimplementation of UniRep in JAX</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.63b94e9e.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@7.1.2/dist/mermaid.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-12498603-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="jax-unirep: A performant reimplementation of UniRep in JAX" class="md-header-nav__button md-logo" aria-label="jax-unirep: A performant reimplementation of UniRep in JAX">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            jax-unirep: A performant reimplementation of UniRep in JAX
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Advanced Usage
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ElArkk/jax-unirep/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ElArkk/jax-unirep
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="jax-unirep: A performant reimplementation of UniRep in JAX" class="md-nav__button md-logo" aria-label="jax-unirep: A performant reimplementation of UniRep in JAX">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    jax-unirep: A performant reimplementation of UniRep in JAX
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ElArkk/jax-unirep/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ElArkk/jax-unirep
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced Usage
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Advanced Usage" class="md-nav__link md-nav__link--active">
      Advanced Usage
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotuning" class="md-nav__link">
    Evotuning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#end-to-end-differentiable-models" class="md-nav__link">
    End-to-end differentiable models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-new-protein-sequences" class="md-nav__link">
    Sampling new protein sequences
  </a>
  
    <nav class="md-nav" aria-label="Sampling new protein sequences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-sampling" class="md-nav__link">
    Basic sampling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-sampling" class="md-nav__link">
    Parallel sampling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-contribution-here" class="md-nav__link">
    Your contribution here
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../development/" title="Development" class="md-nav__link">
      Development
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="API Docs" class="md-nav__link">
      API Docs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotuning" class="md-nav__link">
    Evotuning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#end-to-end-differentiable-models" class="md-nav__link">
    End-to-end differentiable models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-new-protein-sequences" class="md-nav__link">
    Sampling new protein sequences
  </a>
  
    <nav class="md-nav" aria-label="Sampling new protein sequences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-sampling" class="md-nav__link">
    Basic sampling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-sampling" class="md-nav__link">
    Parallel sampling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-contribution-here" class="md-nav__link">
    Your contribution here
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ElArkk/jax-unirep/edit/master/docs/advanced.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="advanced-usage">Advanced Usage</h1>
<p>APIs that support "advanced" tasks are available in <code>jax-unirep</code>.
Read on to learn how to use them.</p>
<h2 id="evotuning">Evotuning</h2>
<p>In the original paper the concept of 'evolutionary finetuning' is introduced,
where the pre-trained mLSTM weights get fine-tuned through weight-updates
using homolog protein sequences of a given protein of interest as input.
This feature is available as well in <code>jax-unirep</code>.
Given a set of starter weights for the mLSTM (defaults to
the weights from the paper) as well as a set of sequences,
the weights get fine-tuned in such a way that test set loss
in the 'next-aa prediction task' is minimized.
There are two functions with differing levels of control available.</p>
<p>The <code>evotune</code> function uses <code>optuna</code> under the hood
to automatically find:
1. the optimal number of epochs to train for, and
2. the optimal learning rate,</p>
<p>given a set of sequences.
The <code>study</code> object will contain all the information
about the training process of each trial.
<code>evotuned_params</code> will contain the fine-tuned mLSTM and dense weights
from the trial with the lowest test set loss.</p>
<details class="note"><summary>Speed freaks read this!</summary><p>As a heads-up, using <code>evotune</code> is kind of slow,
so read on if you're of the impatient kind -- use <code>fit</code>!</p>
</details>
<p>If you want to directly fine-tune the weights
for a fixed number of epochs
while using a fixed learning rate,
you should use the <code>fit</code> function instead.
The <code>fit</code> function has further customization options,
such as different batching strategies.
Please see the function docstring for more information.</p>
<details class="note"><summary>GPU usage</summary><p>The <code>fit</code> function will always default to using a
GPU <code>backend</code> if available for the forward and backward passes
during training of the LSTM.
However, for the calulation of the average loss
on the dataset after every epoch, you can decide
if the CPU or GPU <code>backend</code> should be used (default is CPU).</p>
</details>
<p>You can find an example usages of both <code>evotune</code> and <code>fit</code> <a href="https://github.com/ElArkk/jax-unirep/blob/master/examples">here</a>.</p>
<p>If you want to pass a set of mLSTM and dense weights
that were dumped in an earlier run,
create params as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax_unirep.utils</span> <span class="kn">import</span> <span class="n">load_params</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">load_params</span><span class="p">(</span><span class="n">folderpath</span><span class="o">=</span><span class="s2">&quot;path/to/params/folder&quot;</span><span class="p">)</span>
</code></pre></div>

<p>If you want to start from randomly initialized mLSTM and dense weights instead:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax_unirep.evotuning</span> <span class="kn">import</span> <span class="n">init_fun</span>
<span class="kn">from</span> <span class="nn">jax.random</span> <span class="kn">import</span> <span class="n">PRNGKey</span>

<span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">init_fun</span><span class="p">(</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div>

<p>The weights used in the 10-dimensional embedding of the input sequences
always default to the weights from the paper,
since they do not get updated during evotuning.</p>
<h2 id="end-to-end-differentiable-models">End-to-end differentiable models</h2>
<p>As a user, you might want to write custom "top models",
such as a linear model on top of the reps,
but might want to jointly optimize the UniRep weights
with the top model reps.
You're in luck!</p>
<p>We implemented the mLSTM layers in such a way that
they are compatible with <code>jax.experimental.stax</code>.
This means that they can easily be plugged into
a <code>stax.serial</code> model, e.g. to train both the mLSTM
and a top-model at once:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax.experimental</span> <span class="kn">import</span> <span class="n">stax</span>
<span class="kn">from</span> <span class="nn">jax.experimental.stax</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Relu</span>

<span class="kn">from</span> <span class="nn">jax_unirep.layers</span> <span class="kn">import</span> <span class="n">mLSTM1900</span><span class="p">,</span> <span class="n">mLSTM1900_AvgHidden</span>

<span class="n">init_fun</span><span class="p">,</span> <span class="n">apply_fun</span> <span class="o">=</span> <span class="n">stax</span><span class="o">.</span><span class="n">serial</span><span class="p">(</span>
    <span class="n">mLSTM1900</span><span class="p">(),</span>
    <span class="n">mLSTM1900_AvgHidden</span><span class="p">(),</span>
    <span class="c1"># Add two layers, one dense layer that results in 512-dim activations</span>
    <span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span>
    <span class="c1"># And then a linear layer to produce a 1-dim activation</span>
    <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<p>Have a look at the <a href="https://jax.readthedocs.io/en/latest/jax.experimental.stax.html">documentation</a> and <a href="https://github.com/google/jax/tree/master/examples">examples</a>
for more information about how to implement a model in <code>jax</code>.</p>
<h2 id="sampling-new-protein-sequences">Sampling new protein sequences</h2>
<p>When doing protein engineering,
one core task is proposing new sequences to order by gene synthesis.
<code>jax-unirep</code> provides a number of utility functions inside <code>jax_unirep.sampler</code>
that help with this task.</p>
<h3 id="basic-sampling">Basic sampling</h3>
<p>The key one to focus on is the <code>sample_one_chain</code> function.</p>
<p>This function takes in a starting sequence,
and uses Monte Carlo sampling alongside the Metropolis-Hastings criteria
to score and rank-order new sequences to try out.
The usage pattern is as follows.</p>
<p>Firstly, you <em>must</em> have a scoring function defined
that takes in a string sequence, and outputs a number.
This can be, for example, in the form of a pre-trained machine learning model
that you have created.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax_unirep</span> <span class="kn">import</span> <span class="n">get_reps</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SomeSKLearnModel</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_X</span><span class="p">,</span> <span class="n">training_y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">scoring_func</span><span class="p">(</span><span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">reps</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_reps</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span>
</code></pre></div>

<p>Now, we can use MCMC sampling to propose new sequences.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax_unirep</span> <span class="kn">import</span> <span class="n">sample_one_chain</span>
<span class="n">starter_seq</span> <span class="o">=</span> <span class="s2">&quot;MKLNEQLJLA&quot;</span>  <span class="c1"># can be longer!</span>
<span class="n">sampled_sequences</span> <span class="o">=</span> <span class="n">sample_one_chain</span><span class="p">(</span><span class="n">starter_seq</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring_func</span><span class="o">=</span><span class="n">scoring_func</span><span class="p">)</span>
<span class="n">sampled_seqs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sampled_sequences</span><span class="p">)</span>
</code></pre></div>

<p><code>sampled_sequences</code> is a dictionary
that can be converted directly into a <code>pandas.DataFrame</code>.
In there, every single sequence that was ever sampled is recorded,
as well as its score (given by the scoring function)
and whether it was accepted by the MCMC sampler or not.
(All generated sequences are recorded,
just in case there was something good that was rejected!)</p>
<h3 id="parallel-sampling">Parallel sampling</h3>
<p>If you want to do parallel sampling,
you can use any library that does parallel processing.
We're going to show you one example using <a href="https://dask.org/">Dask</a>,
which happens to be out favourite library for scalable Python!</p>
<p>Assuming you have a Dask <code>client</code> object instantiated:</p>
<div class="highlight"><pre><span></span><code><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># you&#39;ll have to configure this according to your own circumstances</span>

<span class="n">starter_seq</span> <span class="o">=</span> <span class="s2">&quot;MKLNEQLJLA&quot;</span>  <span class="c1"># can be longer!</span>
<span class="n">chain_results_futures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>  <span class="c1"># sample 100 independent chains</span>
    <span class="n">chain_results_futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="c1"># Submit tasks to workers</span>
        <span class="n">client</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
            <span class="n">sample_one_chain</span><span class="p">,</span>
            <span class="n">starter_seq</span><span class="p">,</span>
            <span class="n">n_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">scoring_func</span><span class="o">=</span><span class="n">scoring_func</span><span class="p">,</span>
            <span class="n">pure</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># this is important, esp. with random sampling methods</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="c1"># Gather results from distributed workers</span>
<span class="n">chain_results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">chain_results_futures</span><span class="p">)</span>
<span class="c1"># Convert everything into a single DataFrame</span>
<span class="n">chain_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">chain_results</span><span class="p">])</span>
</code></pre></div>

<h2 id="your-contribution-here">Your contribution here</h2>
<p>Is there an "advanced" protocol that you've developed surrounding <code>jax-unirep</code>?
If so, please consider contributing it here!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../getting-started/" title="Getting Started" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </div>
            </div>
          </a>
        
        
          <a href="../contributing/" title="Contributing" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Contributing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>